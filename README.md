# Tam

[![npm-version][npm-badge]][npm-url]
[![build status][build-badge]][build-url]
[![coverage][coverage-badge]][coverage-url]

[npm-badge]: https://img.shields.io/npm/v/tam.svg
[npm-url]: https://www.npmjs.com/package/tam
[build-badge]: https://api.travis-ci.org/arrowrowe/tam.svg
[build-url]: https://travis-ci.org/arrowrowe/tam
[coverage-badge]: http://codecov.io/github/arrowrowe/tam/coverage.svg?branch=master
[coverage-graph]: http://codecov.io/github/arrowrowe/tam/branch.svg?branch=master
[coverage-url]: http://codecov.io/github/arrowrowe/tam?branch=master

> **T**am is the **A**ssets **M**anager for you. ~~(Tam is a tame lamb!~~

![Tam is a tame lamb!](tam.png)

## What is Tam?

Use Tam to copy, compress, combine, compile and hash static files for packages with dependencies, providing a resource list for each package.

## Why Tam?

Tam is yet young and thus lightweighted. You can take full control of what Tam is doing, as the Gulp sample below shows.

And you can contribute to make Tam better! ;) Tam is still evolving. (Always 100% coverage!)

[![coverage][coverage-graph]][coverage-url]

## Install

### as a library
```sh
npm i --save-dev tam
```

### as a tool
```sh
npm i -g tam
```

It may be more convinient to clone this repo and run `npm link` to get latest Tam globally with `git pull`.

## Usage

### Sample Assets

```javascript
// assets.json
{
  "src": "resources/assets",  // Required.
  "dist": "public/static",    // Required. All output files will be generated here.
  "www": "public",            // Required. It MUST be under dist.
  "linked": "linked.json",    // Required if you use Tam from commandline.
  "option": {                 // Optional. The global option.
    "mode": ["copy", 1],      // Optional. Set to mode `copy` with priority 1. It is default.
    "hash": [0, 0]            // Optional. Hash output files with 0-length hash. (i.e., do not hash.) It is default.
    // Other option you may find handy:
    // "mode": ["compress", 2]
    // "mode": ["copy", 100]
    // "hash": [8, 1]
  },
  "packages": {   // Required. Below are sample packages.
    "angular": {
      "src": "../../node_modules/angular",  // Optional. Will be set to the package's name if left blank.
      "dist": ".",                          // Optional. Will be set to the package's name if left blank.
      "option": { // Optional.
        "mode": ["compress", 2],
        "compress": { // Pass arguments to the compressor. Tam uses UglifyJS for default.
          "warnings": false,
          // Below is just a example... Of course no need to add prefix and suffix for Angular...
          // But you may found this useful if you want to compress some js into one scope...
          "jsPrefix": "(function(){'use strict';",
          "jsSuffix": "})()"
        }
      },
      "files": ["angular.js"] // Required. MUST be a array.
    },
    "core": {
      "dependencies": ["angular"],  // Optional.
      "files": ["angular-app.js"]
    },
    "page/welcome": {
      "dependencies": ["core"],
      "files": ["app.js"]
    }
  }
}
```

If mode set to `compress`, a package named `some-pkg` with many js and css files will be compressed to only two files, `some-pkg.js` and `some-pkg.css`.

SCSS files are always compiled. The output style (expanded or compressed) depends on the mode (copy or compress). It will not be compressed into `some-pkg.js`.

Wildcard is allowed for files, `**/*.js` for example.

If hash set to a positive integer, all js and css will be renamed appended with their hashes (cut to the length set).

Note: if you run `tam` from commandline or call `tam.run()` (they are equivalent), comments in JSON will be stripped automatically by [strip-json-comments](https://www.npmjs.com/package/strip-json-comments).

### Sample Linked

This `linked.json` below is generated by Tam from the above `assets.json`.

```json
{
  "angular": [
    "/static/angular.js"
  ],
  "core": [
    "/static/angular.js",
    "/static/core/angular-app.js"
  ],
  "page/welcome": [
    "/static/angular.js",
    "/static/core/angular-app.js",
    "/static/page/welcome/app.js"
  ]
}
```

### As a tool

Simply type `tam`! See also `tam -h`.

```sh
tam                       # Build and output linked.json according to assets.json
tam whatever.json         # Same as the above except reading whatever.json
tam -a whatever.json      # Same as the above
tam -m compress,3 -s 8,3  # Same as the first except forcing option.mode = ['compress', 3], option.hash = [8, 3]
tam -l trace              # Same as the first except logging all traces
```

### As a library with Gulp

```javascript
// gulpfile.js
var gulp = require('gulp');
var fs = require('fs');
var tam = require('tam');

// Set log level to INFO. See also log4js.
tam.log.setLevel('INFO');

// Custom Tam if you want. See `lib/worker.js` for details.
// tam.worker.tools.compressors.js = WhateverJSCompressorYouWant;
// tam.worker.tools.compilers.scss = WhateverSCSSCompilerYouWant;

gulp.task('build', function () {
  // Equivalent to run `tam` from commandline.
  tam.run();

  // Specify arguments if you like.
  // tam.run({assets: 'assets.json', log: 'info'});

  /* Or you can do it on your own, output ANYTHING if you want to know what Tam is doing exactly.
  var assets = {};  // MUST be a valid Tam-assets object!
  var prepared = tam.prepare(assets);
  var report = tam.build(prepared);
  var linked = tam.link(report, assets.www);
  fs.writeFileSync(assets.linked, JSON.stringify(linked));
  */
});
```

### Then what?

All JavaScript and CSS files each package need can be found in `linked.json` (or somewhere else you specify). Just output them in your HTML as `script` and `link` tags, in anyway you like.

## License and Acknowledgments

[MIT](LICENSE) &copy; [arrowrowe](https://github.com/arrowrowe).

Dependencies:
- [CleanCSS](https://www.npmjs.com/package/clean-css), [UglifyJS](https://www.npmjs.com/package/uglify-js) and [Node-sass](https://www.npmjs.com/package/node-sass) for building.
- [fs-extra](https://www.npmjs.com/package/fs-extra), [glob](https://www.npmjs.com/package/glob) and [hash-file](https://www.npmjs.com/package/hash-file) for other file-related operations.
- [command-line-args](https://www.npmjs.com/package/command-line-args), [log4js](https://www.npmjs.com/package/log4js) and [strip-json-comments](https://www.npmjs.com/package/strip-json-comments) for extra features including cli, log and commentable json.
- [clone](https://www.npmjs.com/package/clone) for keeping configuration immutable.

Dev-dependencies:
- [ESLint](http://eslint.org/) and [JSCS](http://jscs.info/) for linting.
- [Mocha](https://mochajs.org/), [Chai](http://chaijs.com/), [Sinon](http://sinonjs.org/) and [Istanbul](https://www.npmjs.com/package/istanbul) for tests.
- [ghooks](https://www.npmjs.com/package/ghooks) for local linting and tests.

Other servies and integrations:
- [TravisCI](https://travis-ci.org/) and [Codecov](http://codecov.io/) for tests and coverage reports.
- [Shields.io](http://shields.io/) for badges.

## Contribution

Feel free to open issues or send pull requests!
